# My NixOS Setup
This repo contains the configuration files for my continuously evolving personal multi-pc **NixOS 21.05** setup

![desktop](./src/desktop.png)

## Programs
| Type                | Program                     |
| :------------------ | :-------------------------: |
| Editor              | [gEdit](https://wiki.gnome.org/Apps/Gedit) |
| Shell               | [ZSH](https://www.zsh.org) |
| Terminal            | [GNOME Terminal](https://gitlab.gnome.org/GNOME/gnome-terminal) |
| Desktop Environment | [GNOME](https://www.gnome.org) |

## Structure

Here is an overview of the folders' structure:

```
┌── path
├── flake.nix
├── flake.lock
├── secrets
├── users
├── src
│   └── setup.sh
├── modules
│   └── core
├── overlays
│   ├── packages
│   └── patches
└── lib
    ├── host.nix
    └── user.nix
```

- `setup.sh`: initial setup and installation script
- `flake.nix`: main system configuration file, using [flakes](https://nixos.wiki/wiki/Flakes) for easier repository version control and multi-device management
- `modules`: modulated configuration for easier management
- `core`: shared system configuration and scripts
- `overlays`: overrides for pre-built packages
- `packages`: locally built custom packages
- `path`: path to system configuration files, generated by setup script
- `users`: user related configuration and dotfiles

## Installation
Install NixOS using the following commands:  
*Note that the partition label along with the `esp` and `boot` flags must be set on the EFI System Partition*
<pre><code>mkfs.ext4 -L System <i>/path/to/root</i>
mkswap -L swap <i>/path/to/swap</i>
mkfs.fat -F 32 -n boot <i>/path/to/esp</i>
mount /dev/disk/by-label/System /mnt
mkdir -p /mnt/boot/efi
mount /dev/disk/by-partlabel/boot /mnt/boot/efi
nixos-generate-config --root /mnt
nixos-install
</code></pre>

After rebooting, run the following commands:
<pre><code>git clone --recurse-submodules https://github.com/maydayv7/nixos-config.git && cd nixos-config
git-crypt unlock <i>/path/to/key</i>
chmod +x src/setup.sh && ./src/setup.sh
</code></pre>
And follow the instructions to setup and rebuild the system

## Notes
#### Caution
I am pretty new to Nix, and my configuration is still *WIP*, which is right now undergoing a transition to using Nix [Flakes](https://nixos.wiki/wiki/Flakes), an unstable feature. If you have any doubts or suggestions, feel free to open an issue

#### Requirements
- Intel CPU + iGPU
- UEFI System (for use with GRUB EFI Bootloader)

#### Encryption
The contents of `secrets` is encrypted is using `git-crypt`. It is the location where authentication credentials are stored

#### Credentials
Passwords are made using the command `mkpasswd -m sha-512` and then specified using the `hashedPassword` or by specifying the path to the plain text file containing the hashed password using the `passwordFile` option (which I have done by placing passwords in `/etc/passwords`). GPG Keys have to be externally imported (for security purposes)

#### Data Storage
User files are stored on an NTFS partition mounted to `/data`. In my case, even `/etc/nixos` is symlinked to a `git` monitored directory on the partition containing the system configuration files

#### System Management
##### Rebuild
While rebuilding system with Flakes, make sure that any file with unstaged changes will not be included. Use `git add .` in cases where the `git` tree is dirty
##### Scripts
A system management script has been included in `modules/core/scripts.nix` and can be invoked with the command `nixos`, which can be used to apply user and system configuration changes or to perform various other useful functions. Along with that, a system setup script has also been included at `src/setup.sh`, as can be used to setup the system explained in the Installation section

#### Theming
- [Neofetch](https://github.com/dylanaraps/neofetch): Snazzy CLI System Information Tool
- [Powerlevel10K](https://github.com/romkatv/powerlevel10k): P10K ZSH Theme for the fancy-looking prompt using custom configuration
- [Firefox GNOME Theme](https://github.com/rafaelmardojai/firefox-gnome-theme): GNOME Theme for the Mozilla Firefox Browser, used for better desktop integration, `git submodule` imported at `users/v7/config/firefox/`
- [DNOME Discord Theme](https://github.com/GeopJr/DNOME): Discord theme inspired by Adwaita, designed to integrate Discord with GNOME

#### Important Links
- [NixOS Manual](https://nixos.org/manual/nixpkgs/stable)
- [NixOS Discourse](https://discourse.nixos.org/)
- [NixOS Package Search](https://search.nixos.org/)
- [Nixpkgs Repository](https://github.com/NixOS/nixpkgs)
- [Nix User Repository](https://github.com/nix-community/NUR)
- [Home Manager Options](https://rycee.gitlab.io/home-manager/options.html)